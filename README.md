# OPGEE_VBA_ML
This file aims at being a guide throughout the OPGEE notebooks and datasets. 

The main notebook is OPGEE, which contains all the analyses, while OPGEE_VBA and OPGEE_ML contain only the subsections referring respectively to the automation of the VBA code and the prediction of C02 emissions through ML algorithms.

The first section of OPGEE, namely VBA Automation, allows to extract the CO2 emissions computed by the VBA file, given the directories to the VBA and the inputs file respectively. Then, the computed emissions, along with the relevant fields attributes, are stored in a csv file named OPGEE_Data_n, where n stands for the specific iteration. The code automatically detects the number of fields whose emissions have already been computed and starts from the appropriate field in the inputs file. For instance, if there are already three OPGEE_Data files with 20 fields each, then the code automatically starts from the 61th field in the inputs file.

2 variables, namely n_fields and n_iterations, need to be specified for the code to run. n_fields specifies the number of fields which will be inserted in the VBA file at each iteration; since the VBA file can compute at most 499 emissions each time, this also represents the upper bound for n_fields. However, if the goal is to compute more than 499 fields, then n_iterations needs to be set > 1. For instance, if n_fields = 499 and n_iterations = 3, then 499x3 emissions are computed, and at each iteration the code opens the VBA file, fills it with the fields, computes and stores the emissions, and closes the file, which is then reopened in the following iteration in which it is filled with the following 499 fields in the inputs file. 

The code to be run to compute the emissions with the VBA file is also in the separate notebook named OPGEE_VBA, while the file with all the computed emissions is OPGEE_Data.csv.
In the second section, namely Consistency and Sensitivity Checks, it is verified whether fields are correctly classified as HP/HT (either with temperature above 302 or with pressure above 10.000). There exist 155 classified fields, among which none has high pressure, and 80% has high temperature. However, it has been verified that the two variables do not significantly affect the computed emissions, with the difference being at most in the range (-0.35; -0.1) if high pressure is inputted. 

In the third section, namely Emissions Predictions, first the variables are analysed to detect potential outliers and missing values. The distribution of Emissions was characterized by significant outliers; therefore, the variable was winsorized to facilitate learning. Furthermore, missing values have been identified for both h2s and api (37% and 23% respectively). The best strategy to fill in the missing values has been to predict their values given the other regressors through Random Forest. Finally, a dummy variable “united_kingdom” has been generated, which is equal to 1 if the country is the UK and 0 if it is Norway. The obtained dataset has been stored in OPGEE_Training_Data.csv, which has then been used for the prediction of C02 emissions. 

Different configurations of hyperparameters for both Random Forest and Neural Networks (Multilayer Perceptron) have been tested through 7-fold cross-validation. The default Random Forest has proven to be the best configuration, with a mean squared error (MSE) of 0.002. Furthermore, the dummy variable united_kingdom has emerged as the most important (70%), which is proven by the significantly different emissions distributions by country. 

The separate code to re-run Random Forest has been copied in a separate notebook, called OPGEE_ML. 
